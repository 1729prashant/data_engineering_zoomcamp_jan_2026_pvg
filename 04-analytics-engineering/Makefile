.PHONY: build download shell duckdb dbt-debug dbt-run dbt-test clean reset-load help

# Setup commands
download:
	@echo "ğŸ“¥ Downloading and converting data locally..."
	python download_data.py

build:
	@echo "ğŸ”¨ Building Docker image..."
	docker-compose build

# Interactive shells
shell:
	@echo "ğŸ’» Opening bash shell in container..."
	docker-compose run --rm dbt bash

duckdb:
	@echo "ğŸ¦† Opening DuckDB CLI..."
	docker-compose run --rm dbt duckdb taxi_rides_ny.duckdb

# dbt commands
dbt-debug:
	@echo "ğŸ” Running dbt debug..."
	docker-compose run --rm dbt dbt debug

dbt-run:
	@echo "â–¶ï¸  Running dbt models..."
	docker-compose run --rm dbt dbt run

dbt-test:
	@echo "ğŸ§ª Running dbt tests..."
	docker-compose run --rm dbt dbt test

dbt-docs:
	@echo "ğŸ“š Generating dbt documentation..."
	docker-compose run --rm dbt dbt docs generate

# Utility commands
reset-load:
	@echo "ğŸ”„ Resetting data load marker..."
	rm -f taxi_rides_ny/.data_loaded
	@echo "âœ… Next container start will re-load data"

clean:
	@echo "ğŸ§¹ Cleaning up Docker resources..."
	docker-compose down
	@echo "âœ… Docker cleanup complete"

clean-all:
	@echo "ğŸ§¹ Cleaning up everything..."
	docker-compose down
	rm -rf data/
	rm -f taxi_rides_ny/taxi_rides_ny.duckdb
	rm -f taxi_rides_ny/.data_loaded
	@echo "âœ… Full cleanup complete"

# Help
help:
	@echo "Available commands:"
	@echo ""
	@echo "Setup:"
	@echo "  make download    - Download and convert data locally (run FIRST)"
	@echo "  make build       - Build Docker image"
	@echo ""
	@echo "Development:"
	@echo "  make shell       - Open bash shell in container"
	@echo "  make duckdb      - Open DuckDB CLI"
	@echo "  make dbt-debug   - Test dbt connection"
	@echo "  make dbt-run     - Run dbt models"
	@echo "  make dbt-test    - Run dbt tests"
	@echo "  make dbt-docs    - Generate dbt documentation"
	@echo ""
	@echo "Utilities:"
	@echo "  make reset-load  - Force data re-load on next container start"
	@echo "  make clean       - Remove Docker containers"
	@echo "  make clean-all   - Remove everything (data + Docker)"
	@echo "  make help        - Show this help message"